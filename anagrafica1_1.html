<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Anagrafica 5D INF</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 40px auto;
      max-width: 700px;
      background: #ffffff;
      color: #222;
      line-height: 1.6;
    }

    h1 {
      font-size: 26px;
      text-align: center;
      margin-bottom: 30px;
    }

    .box {
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fafafa;
      margin-bottom: 20px;
    }

    input, button {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }

    button {
      background: #f2f2f2;
      cursor: pointer;
    }
    button:hover {
      background: #e4e4e4;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border-bottom: 1px solid #e0e0e0;
      padding: 10px;
    }
    th {
      background: #f7f7f7;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <h1>Anagrafica 5D INF</h1>

  <div class="box">
    <button onclick="mostraUtenti()">Mostra tutti</button>
  </div>

  <div class="box">
    <label>Filtro cognomi: </label>
    <input type="text" id="lettera" maxlength="1">
    <button onclick="filtroCognomi()">Cerca</button>
  </div>

  <div class="box">
    <button onclick="mostraMaggiorenni()">Mostra maggiorenni</button>
  </div>

  <h2>Risultato:</h2>
  <div id="risultato"></div>

  <script>
    let utenti = [];

    function caricaDati() {
      let dati = new XMLHttpRequest();
      dati.open("GET", "dati.json", true);

      dati.onload = function() {
        if (dati.status === 200) {
          utenti = JSON.parse(dati.responseText);
        } else {
          document.getElementById("risultato").textContent = "Errore nel caricamento del file.";
        }
      };
      dati.onerror = function() {
        document.getElementById("risultato").textContent = "Errore di rete!";
      };

      dati.send();
    }

    window.onload = caricaDati;

    function Generazione(anno) {
      if (anno >= 2013) return "Generazione Alpha";
      else if (anno >= 1997) return "Generazione Z";
      else if (anno >= 1981) return "Millennials";
      else if (anno >= 1965) return "Generazione X";
      else if (anno >= 1946) return "Baby Boomers";
      else if (anno >= 1928) return "Generazione Silenziosa";
      else return "Greatest Generation";
    }

    function mostraUtenti() {
      if (utenti.length === 0) {
        document.getElementById("risultato").innerHTML = "Nessun dato caricato!";
        return;
      }
      utenti = utenti['Classe'];

      let html = "<table><tr><th>Nome</th><th>Cognome</th><th>Data di Nascita</th><th>Generazione</th></tr>";
      utenti.forEach(u => {
        let anno = new Date(u.anni).getFullYear();
        html += `<tr><td>${u.nome}</td><td>${u.cognome}</td><td>${u.anni}</td><td>${Generazione(anno)}</td></tr>`;
      });
      html += "</table>";
      document.getElementById("risultato").innerHTML = html;
    }

    function filtroCognomi() {
      if (utenti.length === 0) {
        document.getElementById("risultato").innerHTML = "Dati non caricati.";
        return;
      }
      let lettera = document.getElementById("lettera").value.toUpperCase();
      let filtrati = utenti.filter(u => u.cognome.toUpperCase().startsWith(lettera));

      let html = `<h3>Cognomi che iniziano con '${lettera}':</h3>`;
      html += filtrati.length ? filtrati.map(u => u.cognome).join("<br>") : "Nessun risultato.";

      document.getElementById("risultato").innerHTML = html;
    }

    function mostraMaggiorenni() {
      if (utenti.length === 0) {
        document.getElementById("risultato").innerHTML = "Dati non caricati.";
        return;
      }
      let oggi = new Date();

      let maggiorenni = utenti.filter(u => {
        let nascita = new Date(u.anni);
        let eta = oggi.getFullYear() - nascita.getFullYear();
        let m = oggi.getMonth() - nascita.getMonth();
        if (m < 0 || (m === 0 && oggi.getDate() < nascita.getDate())) eta--;
        return eta >= 18;
      });

      let html = "<h3>Maggiorenni:</h3>";
      html += maggiorenni.length ? maggiorenni.map(u => `${u.nome} ${u.cognome}`).join("<br>") : "Nessun maggiorenne trovato.";

      document.getElementById("risultato").innerHTML = html;
    }
  </script>
</body>
</html>

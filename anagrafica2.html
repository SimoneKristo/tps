<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Anagrafica 2.0</title>
    
</head>
<body>
    <main>
        <h1>Anagrafica 2.0</h1>
        <header>
            <label for="selection">cerca:</label>
            <select id="selection">
                <option value="all">Tutto</option>
                <option value="adult">Cerca solo i maggiorenni</option>
            </select>
            <input id="search" type="search" placeholder="Cerca cognome">
            <button id="btnCerca">Cerca</button>
        </header>

        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Cognome</th>
                    <th>Data di nascita</th>
                    <th>Generazione</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>

        <script>
            let data = [];
            
            function getGenerazione(dateString) {
                const year = new Date(dateString).getFullYear();
                if (year < 1946) return "Silent Generation";
                if (year < 1965) return "Baby Boomers";
                if (year < 1981) return "Generazione X";
                if (year < 1997) return "Millennials";
                return "Generazione Z";
            } 

            const req = new XMLHttpRequest();
            req.open("GET", "studenti.xml");
            req.send();   
            req.onload = function() {
                const xml = req.responseXML;
                const studenti = xml.getElementsByTagName("Studente");
                data = [];

                for (let i = 0; i < studenti.length; i++) {
                    const nome = studenti[i].getElementsByTagName("nome")[0].textContent;
                    const cognome = studenti[i].getElementsByTagName("cognome")[0].textContent;
                    const anni = studenti[i].getElementsByTagName("anni")[0].textContent;
                    data.push({ nome, cognome, anni });
                }
            }

            const selector = document.getElementById('selection');
            const search = document.getElementById('search');
            const searchButton = document.getElementById('btnCerca');
            const tbody = document.getElementById('tbody');

            searchButton.addEventListener('click', () => {
                const query = search.value.toLowerCase();
                const selection = selector.value;
                tbody.innerHTML = "";

                data.forEach(studenti => {
                    const matchesQuery = studenti.cognome.toLowerCase().includes(query);
                    const isAdult = (new Date() - new Date(studenti.anni)) > ((((18*365)*24)*60)*60)*1000;
                    const matchesAdult = selection === 'all' || isAdult;

                    if (matchesQuery && matchesAdult) {
                        tbody.innerHTML += `
                            <tr>
                                <td>${studenti.nome}</td>
                                <td>${studenti.cognome}</td>
                                <td>${studenti.anni}</td>
                                <td>${getGenerazione(studenti.anni)}</td>
                            </tr>
                        `;
                    }
                });
            });
        </script>
    </main>
</body>
</html>